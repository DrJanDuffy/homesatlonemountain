---
import { env } from '../utils/env';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

export interface Props {
  title: string;
  description?: string;
  image?: string;
}

const { 
  title, 
  description = "Find your dream home at Lone Mountain with our expert real estate services.",
  image = "/images/og-default.jpg"
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, env.PUBLIC_SITE_URL);
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="canonical" href={canonicalURL} />
    
    <title>{title}</title>
    <meta name="description" content={description} />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(image, env.PUBLIC_SITE_URL)} />
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={new URL(image, env.PUBLIC_SITE_URL)} />
    
    <!-- Preload critical assets -->
    <link rel="preload" href="/fonts/inter-var.woff2" as="font" type="font/woff2" crossorigin />
    <link rel="preconnect" href="https://em.realscout.com" />
    
    <!-- RealScout Widget Script -->
    <script 
      src="https://em.realscout.com/widgets/realscout-web-components.umd.js" 
      type="module"
      crossorigin="anonymous"
      integrity="sha384-9c3C8DgBMvf8R/lx8578PmHhN3FwC/z+UZuKGwqUK7CL/4yGsl+AKPGBCPQdJh0n"
    ></script>

    <!-- Structured Data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "RealEstateAgent",
        "name": "Homes at Lone Mountain",
        "image": "/images/logo.svg",
        "url": env.PUBLIC_SITE_URL,
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Las Vegas",
          "addressRegion": "NV",
          "postalCode": "89129",
          "addressCountry": "US"
        },
        "geo": {
          "@type": "GeoCoordinates",
          "latitude": 36.2544,
          "longitude": -115.2935
        },
        "areaServed": {
          "@type": "City",
          "name": "Las Vegas"
        }
      }
    </script>

    <!-- RealScout Global Styles -->
    <style is:global>
      realscout-office-listings,
      realscout-advanced-search {
        --rs-primary-color: var(--color-primary, #3A8DDE);
        --rs-font-family: var(--font-sans, system-ui);
        --rs-border-radius: 8px;
        --rs-card-shadow: var(--shadow-md, 0 4px 6px rgba(0, 0, 0, 0.1));
        width: 100%;
        min-height: 480px;
        display: block;
      }
    </style>
  </head>
  <body>
    <div id="page-wrapper">
      <Header />
      
      <main id="main-content">
        <slot />
      </main>

      <Footer />
    </div>

    <!-- Error Boundary -->
    <div id="error-boundary" class="hidden">
      <div class="error-content">
        <h2>Something went wrong</h2>
        <p>We're sorry, but there was an error loading this page. Please try refreshing.</p>
        <button onclick="window.location.reload()">Refresh Page</button>
      </div>
    </div>
  </body>
</html>

<script>
  // Global error handler
  window.addEventListener('error', (event) => {
    console.error('Global error:', event.error);
    showErrorBoundary();
  });

  window.addEventListener('unhandledrejection', (event) => {
    console.error('Unhandled promise rejection:', event.reason);
    showErrorBoundary();
  });

  function showErrorBoundary() {
    const errorBoundary = document.getElementById('error-boundary');
    const pageWrapper = document.getElementById('page-wrapper');
    
    if (errorBoundary && pageWrapper) {
      pageWrapper.style.display = 'none';
      errorBoundary.classList.remove('hidden');
    }
  }
</script>

<style is:global>
  :root {
    --font-sans: 'Inter var', system-ui, -apple-system, sans-serif;
    --color-primary: #3A8DDE;
    --color-primary-dark: #0A2540;
    --color-background: #F7F9FC;
    --color-text: #374151;
    --color-error: #dc2626;
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
  }

  /* Base styles */
  html {
    font-family: var(--font-sans);
    scroll-behavior: smooth;
  }

  body {
    background: var(--color-background);
    color: var(--color-text);
    margin: 0;
    padding: 0;
  }

  /* Error boundary styles */
  #error-boundary {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
  }

  #error-boundary.hidden {
    display: none;
  }

  .error-content {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: var(--shadow-lg);
    text-align: center;
    max-width: 400px;
  }

  .error-content h2 {
    color: var(--color-error);
    margin-bottom: 1rem;
  }

  .error-content button {
    margin-top: 1rem;
    padding: 0.75rem 1.5rem;
    background: var(--color-primary);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.2s ease;
  }

  .error-content button:hover {
    background: var(--color-primary-dark);
    transform: translateY(-1px);
  }
</style> 